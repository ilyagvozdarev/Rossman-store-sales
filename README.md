# Rossmann Store Sales

Решение задачи [Rossmann Store Sales](https://www.kaggle.com/c/rossmann-store-sales/data)

Необходимо спрогнозировать ежедневные продажи на срок до шести недель.<br> 
Продажи в магазине зависят от многих факторов, включая рекламные акции, конкуренцию, школьные и государственные праздники, сезонность и местоположение.


## Оглавление

- [Данные](#данные)
- [Предобработка рядов](#предобработка-рядов)
- [Метрики](#метрики)
- [Методы кластеризации](#методы-кластеризации)
- [Оценка кластеризации и визуализация](#оценка-кластеризации-и-визуализация)<br><br>


## Данные

Файлы `train.csv`, `test.csv` и `store.csv` взяты из [Rossmann Store Sales](https://www.kaggle.com/c/rossmann-store-sales/data).

`train.csv`, `test.csv` - информация о продажах (обучающий и тестовый набор)<br>
`store.csv` - информация о магазинах

`train.csv`, `test.csv`:
- **Id** - идентификатор, представляющий пару (Store, Date) в тестовом наборе.
- **Store** - идентификатор магазина
- **Sales** - продажи в данный день (то, что нужно прогнозировать)
- **Customers** - количество клиентов в данный день 
- **Open** - был ли магазин открыт: 0 = закрыт, 1 = открыт
- **Promo** - действует ли в магазине акция в этот день: 0 = не действует, 1 = действует
- **StateHoliday** - бы ли в данный день государственный праздник. <br>
  Обычно все магазины, за редким исключением, закрыты в   
  государственные праздники. Обратите внимание, что все школы закрыты в праздничные и выходные дни.<br> 
  a = государственный праздник, b = праздник Пасхи, c = Рождество, 0 = нет
- **SchoolHoliday** - указывает, повлияло ли на пару (Store, Date) закрытие государственных школ.

`store.csv`: 
- **StoreType** - модель магазина: a, b, c, d.
- **Assortment** - тип ассортимента: a = базовый, b = дополнительный, c = расширенный
- **CompetitionDistance** - расстояние в метрах до ближайшего магазина конкурента
- **CompetitionOpenSince[Month/Year]** - примерный год и месяц открытия ближайшего конкурента
- **Promo2** - участвует ли в постоянной акции: 0 = магазин не участвует, 1 = магазин участвует
- **Promo2Since[Year/Week]** - год и календарная неделя, когда магазин начал участвовать в Promo2.
- **PromoInterval** - описывает последовательные интервалы запуска Promo2, указывая месяцы, в которые акция начинается заново.<br> 
  Например, «Фев, май, август, ноябрь» означает, что каждый раунд начинается в феврале, мае, августе, ноябре любого данного года 
  для этого магазина.<br><br>


## Предобработка рядов
  - новые признаки созданные из столбца "Date" - день, неделя, месяц, год, день года
  - удаление сильно отличающихся частей рядов (с разрывом, выбросом)
  - определение выбросов методом модфицицированного z-score и замена их на предсказания xgboost
  - заполнение дней, когда магазин закрыт, медианой соседних значений (только для модели линейной регрессии)
<br/>

LinearRegression
<br/>
<br/>
признаки модели:
  - константный
  - признак тренда 2 порядка
  - признак Фурье порядка 6 для годового сезона
  - сезонные индикаторы дня недели, дня месяца
  - индикатор Нового года, индикатор 22 или 23 числа декабря
  - Promo - проходит ли акция в этот день
  - лаги: 1, 2, 7, 14, 28, 42
  - скользящие статистики: медиана с окном 28, матожидание с окном 28, стандартное отклонение с окном 14, сумма с окном 28

признаки модели для укороченных рядов:
  - константный
  - сезонные индикаторы дня недели, дня месяца
  - индикатор Нового года, индикатор 22 или 23 числа декабря
  - Promo - проходит ли акция в этот день

<br/>
Xgboost
<br/>
<br/>
Две модели: первая - для всех рядов кроме коротких (обучение на всех рядах кроме коротких), вторая - для коротких рядов (обучение на всех рядах)
<br/>
<br/>

признаки модели:
  - столбцы 'Store', 'Date', 'DayOfWeek', 'Open', 'Promo', 'SchoolHoliday', 'StateHoliday' из тренировочного набора
  - среднее число продаж за день, среднее число посетителей за день, среднее число продаж на 1 посетителя за день
  - номер дня, недели, месяца, года, дня года
  - столбцы 'StoreType', 'Assortment', 'CompetitionDistance', 'CompetitionOpenInt' (эпохальное время открытия ближайшего конкурента), 
    'PromoInterval' из данных для магазинов
<br/>

Дальнейшие проверки:
<br/>

Провести кластеризацию рядов и подготовить для xgboost тренировочный набор стратифицированный по кластерам.
